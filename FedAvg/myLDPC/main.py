#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Created on Thu Aug 10 21:08:38 2023

@author: jack

numpy.nonzero()
numpy.nonzero() 函数返回输入数组中非零元素的索引。

numpy.where()
numpy.where() 函数返回输入数组中满足给定条件的元素的索引。


"""
## system lib
import numpy  as np



##  自己编写的库
from sourcesink import SourceSink
from channel import AWGN
from modulation import  BPSK,  demodu_BPSK
import utility
from argsLDPC import arg
from ldpc_coder import LDPC_Coder_Llr


utility.set_random_seed()

source = SourceSink()
ldpccode =  LDPC_Coder_Llr(arg)


def  BPSK_AWGN_Simulation(args):

    for snr in np.arange(args.minimum_snr, args.maximum_snr + args.increment_snr/2.0, args.increment_snr):
        channel = AWGN(snr)
        source.ClrCnt()

        print( f"\nsnr = {snr}(dB):\n")
        while source.m_num_tot_blk < args.m_max_blk_num and source.m_num_err_blk < args.m_max_blk_err:
            uu = source.GenerateBitStr(ldpccode.codedim)
            cc = ldpccode.encoder(uu)
            yy = BPSK(cc)
            yy = channel.forward(yy)

            yy_recv = utility.yyToLLR(yy, channel.noise_var)

            uu_hat, iter_num = ldpccode.decoder(yy_recv)
            source.CntErr(uu, uu_hat)
            if source.m_num_tot_blk % 1000 == 0:
                source.PrintScreen(snr = snr)
                # source.PrintResult(log = f"{snr:.2f}  {source.m_ber:.8f}  {source.m_fer:.8f}")
        print("  *** *** *** *** ***\n");
        source.PrintScreen(snr = snr);
        print("  *** *** *** *** ***\n");

        source.SaveToFile(snr = snr)

    return























































































































































































































































































































































































































































































