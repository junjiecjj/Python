# OFDM 雷达 - 通信一体化系统仿真原理总结（公式规范版）

该代码实现了**OFDM（正交频分复用）雷达 - 通信一体化系统**的完整仿真，核心是通过一套 OFDM 信号同时完成数据通信和目标探测（距离估计），并通过模糊函数分析雷达信号的距离 - 多普勒分辨性能。以下按代码模块拆解核心原理，涵盖系统设计、信号处理、信道建模及性能分析全流程，所有公式均采用规范数学表达。

## 一、系统参数配置：OFDM 一体化系统的基础参数设定

该模块定义支撑通信和雷达功能的核心物理与信号参数，参数间需满足 OFDM 系统正交性和工程实用性。



| 参数类别     | 关键参数      | 数值 / 设定                         | 原理作用与核心公式                                                                                                                               |
| -------- | --------- | ------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------- |
| 物理层参数    | 载波频率`f_c` | 30GHz（毫米波）                      | 决定信号波长，公式：$\lambda = \frac{c_0}{f_c}$（$c_0$为光速，计算得$\lambda=0.01\,\text{m}$），影响雷达多普勒频移精度。                                                |
| OFDM 帧结构 | 子载波数`N`   | 256                             | 子载波正交性条件：子载波间隔$\Delta f = \frac{1}{T}$（$T$为符号时长），$N$越大，频域分辨率越高。                                                                         |
|          | 符号数`M`    | 16                              | 构成$N \times M$的 OFDM 数据块，平衡通信速率（$R = N \cdot M \cdot \text{bitsPerSymbol} / T_{\text{总}}$）与雷达探测精度。                                      |
|          | 子载波间隔`Δf` | 1.536MHz                        | 符号时长$T = \frac{1}{\Delta f} \approx 651\,\text{ns}$，保证子载波正交（相邻子载波在符号周期内叠加为 0）。                                                          |
|          | 循环前缀（CP）  | 长度 64（$N/4$）                    | CP 时长$T_{\text{cp}} = \frac{T}{4} \approx 163\,\text{ns}$，需大于信道最大时延以对抗符号间干扰（ISI）；总符号周期$T_s = T + T_{\text{cp}} \approx 814\,\text{ns}$。 |
| 通信调制参数   | 调制方式      | 4-QAM（$\text{bitsPerSymbol}=2$） | 每个子载波承载 2bit 数据，调制映射关系（如 00→$1+j$、01→$-1+j$等），归一化功率保证信号幅度稳定。                                                                            |

## 二、发射机模块：OFDM 一体化信号的生成

核心是将通信数据调制为满足正交性的 OFDM 时域信号，该信号同时作为通信发射信号和雷达探测信号，实现 “一信号两用”。

### 信号生成流程及原理：



1.  **通信数据生成与 QAM 调制**

*   生成$N \times M$（256×16）的随机二进制数据矩阵`data`，代表待传输的通信信息。

*   **4-QAM 调制**：通过`qammod`函数将二进制数据映射为复基带符号，满足功率归一化条件：

    $E[|x_{k,m}|^2] = 1$

    其中$x_{k,m}$为第$k$个子载波、第$m$个符号的 QAM 调制符号（$k=0,1,...,N-1$；$m=0,1,...,M-1$），输出调制后频域数据`TxData`。

1.  **OFDM 调制：频域→时域（IFFT + 加 CP）**

*   **IFFT 变换**：对$N \times M$的 QAM 符号做$N$点逆傅里叶变换，将频域信号转换为时域 OFDM 符号：

    $s_{m}(t) = \frac{1}{\sqrt{N}} \sum_{k=0}^{N-1} x_{k,m} \cdot e^{j2\pi k \Delta f \cdot t}, \quad t \in [0, T)$

    代码中通过`ifft(TxData, N)`实现，得到时域符号矩阵`TxSignal_IFTT`（维度$N \times M$）。

*   **添加循环前缀（CP）**：将每个时域符号的后$N_{\text{cp}}$（64）个采样点复制到符号开头，形成带 CP 的符号：

$$$s_{m}(t + T - T_{\text{cp}}), & t \in [0, T_{\text{cp}}) \\
s_{m}(t), & t \in [T_{\text{cp}}, T_s)
\end{cases}$$  
代码中表示为`[TxSignal_IFTT(N-CPsize+1:N, :); TxSignal_IFTT]`，输出`TxSignal_cp`（维度$(N+N_{\text{cp}}) \times M$）。  $$$



*   **信号整形**：将$M$个带 CP 的符号拼接为一维时域信号：

    $s_{\text{tx}}(t) = \bigcup_{m=0}^{M-1} s_{m,\text{cp}}(t - m \cdot T_s)$

    代码中通过`reshape(TxSignal_cp, [], 1)`实现，得到最终发射信号`TxSignal_time`。

## 三、通信信道与接收：多径信道下的 OFDM 数据传输

该模块模拟通信链路的信号传输与接收恢复，核心是对抗多径衰落和噪声干扰，验证通信功能的可靠性（以误码数衡量）。

### 1. 通信信道建模：瑞利衰落多径信道



*   **多径信道冲击响应**：实际无线信道的多径特性可用线性时不变（LTI）系统的冲击响应描述：

    $h(\tau) = \sum_{l=0}^{L-1} a_l \cdot \delta(\tau - \tau_l)$

    其中：


    *   $L=5$（信道抽头数），$\tau_l$为第$l$个抽头的时延（代码中`Delay = [0,3,5,6,8]`，单位：采样点）；
    
    *   $a_l$为第$l$个抽头的复增益，服从瑞利分布（由`randn(1,L) + 1j*randn(1,L)`模拟复高斯噪声，乘功率系数$\sqrt{P_l/2}$，$P_l=10^{\text{PowerdB}_l/10}$为抽头功率）。
    
        代码中通过`h(Delay+1) = (randn + 1j*randn) .* sqrt(Power/2)`生成信道冲击响应`h`（维度$1 \times L_{\text{ch}}$，$L_{\text{ch}}=\tau_{\text{max}}+1=9$）。

### 2. 信号传输与接收处理



| 处理环节       | 代码操作                           | 核心原理与公式                                                                                                                                                                                                        |
| ---------- | ------------------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 信道传输       | `conv(TxSignal_time, h)`       | 信号在多径信道中传输等效于时域卷积：$r_{\text{com}}(t) = s_{\text{tx}}(t) * h(t)$，体现多径信号叠加效应。                                                                                                                                    |
| 加性噪声       | `awgn(..., ComSNRdB=15)`       | 加入高斯白噪声（AWGN），信噪比定义：\$\text {SNR}*{\text{dB}} = 10\log*{10}\left( \frac{E\[                                                                                                                                    |
| 接收端预处理     | 去 CP（截取后半段$N$点）→ FFT 变换（`fft`） | - 去 CP：$r_{m}(t) = r_{\text{com}}(t + mT_s), \quad t \in [T_{\text{cp}}, T_s)$，消除 ISI；- FFT 变换：$R_{k,m} = \text{FFT}\{r_{m}(t)\} = H_k \cdot X_{k,m} + N_k$，将时域信号变回频域（$H_k$为频域信道响应，$N_k$为频域噪声），输出`RxData_com`。 |
| 信道均衡（MMSE） | \`C = conj(H\_channel) ./ (    | H\_channel                                                                                                                                                                                                     |
| 解调与误码统计    | `qamdemod`解调 → 对比二进制位          | - QAM 解调：$\hat{b}_{k,m} = \text{QAMDemod}(\hat{X}_{k,m})$，将均衡后的频域符号映射回二进制数据；- 误码数：$\text{errorCount} = \sum_{k,m} \text{XOR}(b_{k,m}, \hat{b}_{k,m})$，统计原始数据与解调数据的二进制位差异，反映通信可靠性。                              |

## 四、雷达信道与目标探测：基于 OFDM 信号的距离估计

该模块利用同一 OFDM 发射信号的 “目标反射回波” 实现雷达功能，核心是通过时延估计目标距离、通过多普勒频移估计速度（代码中暂实现距离估计）。

### 1. 雷达目标参数与回波建模



*   **目标核心参数推导**：


    *   **双程时延**：信号往返目标的时间，与目标距离$R$的关系：
    
        $\tau_0 = \frac{2R}{c_0}$
    
        代码中目标距离$R=30\,\text{m}$，计算得$\tau_0 = \frac{2 \times 30}{3 \times 10^8} = 2 \times 10^{-7}\,\text{s}$（`target_delay`）。
    
    *   **多普勒频移**：运动目标导致的信号频率偏移，与目标速度$v$的关系：
    
        $f_d = \frac{2v}{\lambda}$
    
        代码中目标速度$v=20\,\text{m/s}$，波长$\lambda=0.01\,\text{m}$，计算得$f_d = \frac{2 \times 20}{0.01} = 4000\,\text{Hz}$（`target_dop`）。

*   **雷达回波信号模型**：目标反射的回波信号在频域可表示为：

    $X_{k,m}^{\text{radar}} = \sqrt{\text{SNR}_{\text{radar}}} \cdot X_{k,m} \cdot e^{j\phi_{k,m}} + N_{k,m}^{\text{radar}}$

    其中：


    *   $\text{SNR}_{\text{radar}} = 10^{30/10} = 1000$（雷达信噪比，`RadarSNRdB=30`）；
    
    *   相位偏移$\phi_{k,m}$（由时延和多普勒共同引起）：
    
        $\phi_{k,m} = -2\pi \left( f_c \tau_0 + m \Delta f \tau_0 - k T_s f_d \right)$
    
        （$k$为子载波索引，$m$为符号索引，代码中通过`meshgrid`生成索引网格`kSub, mSym`计算）；
    
    *   $N_{k,m}^{\text{radar}}$为雷达回波的复高斯噪声（`randn(N,M) + 1j*randn(N,M)`）。
    
        代码中输出雷达回波频域信号`RxData_radar`。

### 2. 距离估计流程



1.  **去调制（信号净化）**：抵消发射信号的调制信息，提取目标相关的相位信息：

    $Y_{k,m} = \frac{X_{k,m}^{\text{radar}}}{X_{k,m}} = \sqrt{\text{SNR}_{\text{radar}}} \cdot e^{j\phi_{k,m}} + \frac{N_{k,m}^{\text{radar}}}{X_{k,m}}$

    代码中通过`dividerArray = RxData_radar ./ TxData`实现，消除调制符号$X_{k,m}$的影响。

2.  **距离维 FFT（时延估计）**：对去调制后的信号沿子载波方向（$k$维度）做补零 IFFT，将频域相位信息转换为时域时延信息：

    $y(\tau) = \text{IFFT}\{Y_{k,m}\}_{N_{\text{Per}}}$

    其中$N_{\text{Per}}=16 \times N=4096$（补零点数，提升距离分辨率），代码中通过`ifft(dividerArray, NPer, 1)`实现，输出`range_fft`。

3.  **距离计算**：

*   功率谱：$P(\tau) = |y(\tau)|^2$，沿符号方向（$m$维度）平均以抑制噪声：$\bar{P}(\tau) = \frac{1}{M} \sum_{m=0}^{M-1} P_m(\tau)$（代码中`mean_range_power`）。

*   距离轴：根据时延与距离的关系，结合 FFT 分辨率，距离轴公式为：

    $R(n) = \frac{n \cdot c_0}{2 \cdot N_{\text{Per}} \cdot \Delta f}, \quad n=0,1,...,N_{\text{Per}}-1$

*   估计距离：找到功率谱峰值对应的索引$n_0$，则估计距离$R_{\text{est}} = R(n_0)$（代码中`distanceE`），与真实距离$R=30\,\text{m}$对比验证雷达精度。

## 五、模糊函数计算：评估雷达信号的分辨能力

模糊函数（Ambiguity Function）是雷达信号的核心性能指标，用于衡量信号在**距离 - 多普勒平面**的分辨能力（主瓣宽度决定分辨力，旁瓣高度决定抗干扰能力）。

### 1. 模糊函数定义与计算



*   **数学定义**：对于发射信号$s(t)$，模糊函数为信号与 “时移$\tau$+ 多普勒频移$f_d$后的信号” 的互相关幅度：

    $\chi(\tau, f_d) = \left| \int_{-\infty}^{+\infty} s(t) \cdot s^*(t - \tau) \cdot e^{j2\pi f_d t} dt \right|$

    其中$\tau$为目标时延（对应距离），$f_d$为目标多普勒频移（对应速度），$\chi(\tau, f_d)$的峰值位置对应目标的真实$\tau_0$和$f_d_0$。

*   **代码计算流程**：

1.  设定分析范围：时延范围$\tau \in [-\tau_{\text{max}}, \tau_{\text{max}}]$（$\tau_{\text{max}}=2\tau_0$），多普勒范围$f_d \in [-f_{d,\text{max}}, f_{d,\text{max}}]$（$f_{d,\text{max}}=2f_d_0$），各取 150 个采样点（`tau_points=150`，`fd_points=150`）。

2.  时移信号生成：对发射信号$s(t)$做时移$\tau$，通过线性插值（`interp1`）保证非整数采样点的时移精度，得到$s(t-\tau)$（代码中` s_tau_padded`）。

3.  多普勒频移：给时移信号乘以频移因子$e^{j2\pi f_d t}$（代码中`doppler_shift`）。

4.  互相关计算：对每个$(\tau, f_d)$，计算$\chi(\tau, f_d) = |s(t)^T \cdot (s(t-\tau) \cdot e^{j2\pi f_d t})|$，得到$150 \times 150$的模糊函数矩阵`ambiguity_func`，并归一化（除以最大值）。

### 2. 关键切片分析



*   **距离切片**：固定多普勒频移$f_d=0$，提取模糊函数在时延轴的截面$\chi(\tau, 0)$，反映信号的**距离分辨力**：

    $\text{距离分辨力} \approx \frac{c_0}{2 \cdot B}$

    其中$B=N \cdot \Delta f$为 OFDM 信号带宽，主瓣越窄，距离分辨力越高（代码中`range_slice`）。

*   **速度切片**：固定时延$\tau=0$，提取模糊函数在多普勒轴的截面$\chi(0, f_d)$，反映信号的**速度分辨力**：

    $\text{速度分辨力} \approx \frac{\lambda}{2 \cdot T_{\text{total}}}$

    其中$T_{\text{total}}=M \cdot T_s$为信号总时长，主瓣越窄，速度分辨力越高（代码中`doppler_slice`）。

## 六、结果可视化：系统性能直观呈现

代码生成两类图（共 12 个子图），全面展示通信、雷达、模糊函数的核心性能，关键图表及意义如下：



| 图表类别          | 核心子图              | 呈现内容与意义                                                                 |
| ------------- | ----------------- | ----------------------------------------------------------------------- |
| 系统综合性能图（8 子图） | 发射信号时域 / 频域       | 时域图区分 CP（红色虚线）与数据部分（蓝色实线），验证 CP 添加正确性；频域图展示子载波功率分布，验证 QAM 调制与 OFDM 正交性。 |
|               | 通信信道冲击响应          | stem 图展示多抽头的幅度分布，直观呈现信道的多径衰减特性。                                         |
|               | 雷达距离 - 功率谱        | 对比真实距离（红色虚线）与估计距离（绿色点线），直接验证雷达距离估计精度。                                   |
|               | 模糊函数 3D 图 / 等高线   | 3D 图展示$\chi(\tau, f_d)$的空间分布，等高线图标记目标真实位置（红色圆点），直观评估信号的距离 - 多普勒联合分辨能力。  |
| 模糊函数详细图（4 子图） | 距离切片 / 速度切片（dB 值） | 以 dB 为单位展示切片的主瓣 / 旁瓣分布，量化分析：主瓣宽度（分辨力）、旁瓣高度（抗干扰能力）。                      |

## 七、一体化系统核心优势与原理总结



1.  **资源复用**：一套 OFDM 信号同时承载通信数据（QAM 调制符号）和雷达探测信息（时延 / 多普勒相位），无需额外分配频带 / 时间资源，频谱效率提升一倍以上。

2.  **信号兼容性**：OFDM 信号的正交性同时满足两类功能需求：

*   通信：抗多径、高频谱效率，适合高速数据传输；

*   雷达：子载波间隔固定，时延 / 多普勒在频域表现为线性相位，便于通过 FFT 实现高精度估计。

1.  **性能可量化**：通过通信误码数评估通信可靠性，通过模糊函数评估雷达分辨力，形成 “通信 - 雷达” 一体化的性能评估体系，为系统优化（如调制方式、子载波数、CP 长度）提供依据。

该仿真完整覆盖 “信号生成→信道传输→接收处理→性能分析” 全流程，是 OFDM 雷达 - 通信一体化系统的典型实现，可直接用于后续算法优化（如模糊函数旁瓣抑制、MIMO 扩展等）。

> （注：文档部分内容可能由 AI 生成）